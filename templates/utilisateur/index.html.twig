{% extends 'base.html.twig' %}

{% block title %}Liste des Utilisateurs{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/utilisateur.css') }}?v={{ "now"|date("U") }}">
    {% endblock %}

{% block body %}
<div class="container mt-5">
    <h2 class="text-center">Liste des utilisateurs</h2>

    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endfor %}

    <!-- Add User Button -->
    <a href="{{ path('app_utilisateur_new') }}" class="btn btn-primary mb-3">Ajouter un utilisateur</a>

    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Email</th>
                <th>Mobile</th>
                <th>Désignation</th>
                <th>Équipements</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in utilisateurs %}
                <tr>
                    <td>{{ user.idU }}</td>
                    <td>{{ user.nom }}</td>
                    <td>{{ user.pren }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.mobile }}</td>
                    <td>
                        {% if user.designation %}
                            {{ user.designation.libelle }}
                        {% else %}
                            <span class="text-muted">Non assigné</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if user.equipements is not empty %}
                            <ul class="list-unstyled">
                                {% for equipement in user.equipements %}
                                    <li>
                                        <p><strong>ID:</strong> {{ equipement.id_eq }}</p>
                                        <p><strong>Modèle:</strong> {{ equipement.modele }}</p>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p>Aucun équipement</p>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ path('app_utilisateur_show', {'id_u': user.idU}) }}" class="btn btn-info btn-sm">Voir</a>
                        <a href="{{ path('app_utilisateur_edit', {'id_u': user.idU}) }}" class="btn btn-warning btn-sm">Modifier</a>
                        
                        <form method="post" action="{{ path('app_utilisateur_delete', {'id_u': user.idU}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.idU) }}">
                            <button class="btn btn-danger btn-sm">Supprimer</button>
                        </form>                                          
                        
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <p class="text-center text-danger" {% if utilisateurs is not empty %} style="display:none;" {% endif %}>Aucun utilisateur trouvé.</p>
</div>
{% endblock %}